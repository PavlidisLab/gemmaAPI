<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>/home/omancarci/git repos/gemmaAPI/CONTRIBUTING.md • gemmaAPI</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script>
<script src="pkgdown.js"></script>
  
  
<meta property="og:title" content="/home/omancarci/git repos/gemmaAPI/CONTRIBUTING.md" />
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">gemmaAPI</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="contents col-md-12">
    <div class="page-header">
      <h1>/home/omancarci/git repos/gemmaAPI/CONTRIBUTING.md</h1>
    </div>

<div id="contributing-to-gemmaapi" class="section level1">
<h1 class="hasAnchor">
<a href="#contributing-to-gemmaapi" class="anchor"></a>Contributing to gemmaAPI</h1>
<p>Endpoint functions in gemmaAPI follow a simple pattern and their documentation is lifted from the documentation page for the restful API unless R specific clarifications/changes are required.</p>
<div id="adding-a-new-request-to-an-endpoint" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-new-request-to-an-endpoint" class="anchor"></a>Adding a new request to an endpoint</h2>
<ol>
<li>
<p><strong>Update the documentation:</strong> The request will be specified by the <code>request</code> argument. Add the name and description of the request as an item under the request section as shown below</p>
<div class="sourceCode"><pre class="sourceCode R"><code class="sourceCode r"><span class="co">#' @param request Character. If NULL retrieves the dataset object. Otherwise</span>
<span class="co">#'  \itemize{</span>
<span class="co">#'      \item \code{platforms}: Retrieves platforms for the given dataset</span>
<span class="co">#'      \item \code{newRequest}: does whatever the request does</span>
<span class="co">#'  }</span></code></pre></div>
<p>If the request has arguments create another itemized list under the request name and description</p>
<div class="sourceCode"><pre class="sourceCode R"><code class="sourceCode r"><span class="co">#' @param request Character. If NULL retrieves the dataset object. Otherwise</span>
<span class="co">#'  \itemize{</span>
<span class="co">#'      \item \code{platforms}: Retrieves platforms for the given dataset</span>
<span class="co">#'      \item \code{newRequest}: does whatever the request does</span>
<span class="co">#'          \itemize{</span>
<span class="co">#'              \item \code{argumentForNewRequest}: this arg is needed because...</span>
<span class="co">#'              \item \code{otherArgForNewRequest}: this arg is needed because...</span>
<span class="co">#'          }</span>
<span class="co">#'  }</span></code></pre></div>
</li>
<li>
<p><strong>Add the request as an aviable option:</strong> All endpoint functions check request with <code>match.args</code>. Go to this line and add your request</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">request =<span class="st"> </span><span class="kw">match.args</span>(request,
                    <span class="dt">choices  =</span> <span class="kw">c</span>(<span class="st">'platforms'</span>,
                                 <span class="st">'newRequest'</span>))</code></pre></div>
</li>
<li>
<p><strong>Add the accepted arguments as available arguments:</strong> All endpoint functions check for allowed arguments for a given request. If the new request arguments, add them to the list named <code>allowedArguments</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">allowedArguments =<span class="st"> </span><span class="kw">list</span>( <span class="co"># ... allowed arguments for other requests are listed here</span>
                        <span class="dt">newRequest =</span> <span class="kw">c</span>(<span class="st">'argumentForNewRequest'</span>,
                                       <span class="st">'otherArgForNewRequest'</span>))</code></pre></div>
</li>
<li>
<p><strong>Add the mandatory arguments:</strong> Similar to <code>allowedArguments</code> list, all endpoint functions check to see if all mandatory arguments for a request is probided. If the new request has mandatory arguments add them to the list named <code>mandatoryArguments</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mandatoryArguments =<span class="st"> </span><span class="kw">list</span>(<span class="co"># ... mandatory arguments for other requests are listed here</span>
                          <span class="dt">newRequest =</span> <span class="kw">c</span>(<span class="st">'argumentForNewRequest'</span>))</code></pre></div>
<p>In this case when the endpoint is called with <code>request = newRequest</code> it will give a warning if any arguments other than <code>argumentForNewRequest</code> and <code>otherArgForNewRequest</code> is provided and an error if <code>argumentForNewRequest</code> is not provided.</p>
<ol>
<li>
<strong>Build the URL for the request:</strong> Below the lines you just edited, you’ll see logic for building the URLs. Normally, a base url is constructed and request specific additions are added based on what request is made. <code>glue</code> function is used to do this in a clean looking way. Any arguments for a request is added by <code>stringArg</code>, <code>logicArg</code> and <code>numberArg</code> functions. <code>stringArg</code> allows both numbers and strings since many string inputs also accept identifiers in numeric form. It also uses <code>URLencode</code> on the input. <code>logicArg</code> makes sure the input is logical and <code>numberArg</code> makes sure it is numeric. If the inputs of these functions are NULL they’ll return empty strings so no need to check if a non-mandatory input is provided or not. Note that the <code>addName</code> argument can be used to control if names of the arguments should be added.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stringArg</span>(<span class="dt">anArg =</span> <span class="st">'Arbitrary*String'</span>,<span class="dt">anotherArg =</span> <span class="st">'Arbitrary_String'</span>,<span class="dt">addName=</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode R"><code class="sourceCode r">## anArg=Arbitrary%2AString&amp;anotherArg=Arbitrary_String</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stringArg</span>(<span class="dt">anArg =</span> <span class="st">'Arbitrary*String'</span>,<span class="dt">anotherArg =</span> <span class="st">'Arbitrary_String'</span>,<span class="dt">addName=</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode R"><code class="sourceCode r">## Arbitrary%2AString&amp;Arbitrary_String</code></pre></div>
<p>Note that if the request does not follow the basic formula, you may have to re-write the url from scratch.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if(<span class="dt">request =</span><span class="st">'platforms'</span>){
    url =<span class="st"> </span>glue::<span class="kw">glue</span>(url,<span class="st">'/platforms'</span>)
} else if(request==<span class="st">'newRequest'</span>){
    url =<span class="st"> </span>glue::<span class="kw">glue</span>(url,<span class="st">'/newRequest?'</span>,<span class="kw">stringArg</span>(<span class="dt">argumentForNewRequest =</span> argumentForNewRequest),<span class="st">'&amp;'</span>,
                     <span class="kw">logicArg</span>(<span class="dt">otherArgForNewRequest =</span> otherArgForNewRequest))
}</code></pre></div>
</li>
<li>
<p><strong>If the output is a list, name the elements:</strong> If the output of the request is a gzipped table, it will be read and returned as a dataframe, but in most cases output is a JSON which is returned as a list.</p>
<p>The output is saved in <code>content</code> object, whose elements are renamed before returning. An identifying property of the elements is used as the name. This property must always be defined and ideally be unique to the element. For instance in the below example, platforms always have shortNames and they are good identifying strings so they are used. For our <code>newRequest</code> we choose the <code>namingElement</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if(return){
    if(<span class="kw">is.null</span>(request)){
        <span class="kw">names</span>(content) =<span class="st">  </span>content %&gt;%<span class="st"> </span>purrr::<span class="kw">map_chr</span>(<span class="st">'officialSymbol'</span>)
    } else if (request %in%<span class="st"> 'plaftorm'</span>){
        <span class="kw">names</span>(content) =<span class="st">  </span>content %&gt;%<span class="st"> </span>purrr::<span class="kw">map_chr</span>(<span class="st">'shortName'</span>)
    } else if(request %in%<span class="st"> 'newRequest'</span>){
        <span class="kw">names</span>(content) =<span class="st"> </span>content %&gt;%<span class="st"> </span>purrr::<span class="kw">map_chr</span>(<span class="st">'namingElement'</span>)
    }
}</code></pre></div>
</li>
<li>
<p><strong>Write tests:</strong> Each endpoint has it’s own test file in ‘tests/testthat’ repo New test files must start with the name <code>test</code> to be visible to <code>testthat</code> package. A minimal testing should be done to ensure the output has the right type and and is not empty. Certain behaviors of Gemma API changed over time so it is good to provide tests for inputs with expected lengths so you can fail if something changes in the future again. Errors from absance of mandatory inputs could be included. Below some examples are provided.</p>
<ol>
<li>
<p>Validating the output type</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testthat::<span class="kw">expect_is</span>(<span class="kw"><a href="reference/datasetInfo.html">datasetInfo</a></span>(<span class="st">'GSE12679'</span>,<span class="dt">request =</span> <span class="st">'differential'</span>,
                    <span class="dt">qValueThreshold =</span> <span class="dv">1</span>),<span class="st">'list'</span>)</code></pre></div>
</li>
<li>
<p>Validating the length of the output</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testthat::<span class="kw">expect_length</span>(<span class="kw"><a href="reference/datasetInfo.html">datasetInfo</a></span>(<span class="st">'GSE81454'</span>),<span class="dv">1</span>)
testthat::<span class="kw">expect_true</span>(<span class="kw">length</span>(<span class="kw"><a href="reference/datasetInfo.html">datasetInfo</a></span>(<span class="st">'GSE81454'</span>,
                                         <span class="dt">request =</span> <span class="st">'samples'</span>))&gt;<span class="dv">0</span>)</code></pre></div>
</li>
<li>
<p>Error from absance of mandatory input</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testthat::<span class="kw">expect_error</span>(<span class="kw"><a href="reference/datasetInfo.html">datasetInfo</a></span>(<span class="st">'GSE81454'</span>,<span class="dt">request =</span> <span class="st">'differential'</span>),
                       <span class="dt">regexp =</span> <span class="st">'qValueThreshold'</span>)</code></pre></div>
</li>
</ol>
</li>
</ol>
</div>
</div>

  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>

